# 競馬予測プログラム(Python)

## 概要
競馬の回収率が100%を超えるモデルを作成し、予測結果を自動で通知できるようにする。
また、Qiitaなどでそれをアウトプットする

### スクレイピング
seleniumを使用する
1. 月ごとに全レースへのURLを取得(get_race_url.py)
2. レースの概要と、馬ごとの結果をそれぞれテーブルとして保存
### データ整形・trainデータ作成
また1レースの馬1頭ごとにtrainデータを1つ(1行)作成・保存する。
### train
上位入賞をkerasのディープラーニングで予測、回収率を強化学習や遺伝的アルゴリズムで最大化
時系列データで過去のレース結果を保持しているので、リークしないように注意する
### データの検証
trainして得られたデータを検証する。


## ファイル概要
- scraping.py

## 取得データ
### race_data(レースごとの概要データ)
id: https://db.netkeiba.com/race/201945013101/ などに含まれる 201945013101 の部分
払い戻しを含めたレースの概要を保存する。
### race_each_horse_data(あるレースの馬ごとのデータ)
固有の識別番号は無し。レースidと馬idからレコードを識別できる。
その時の体重・単勝オッズなど、レース時における馬固有のデータを保持

## train データ
### 上位入賞予測(馬ごと)
race_dataの行ごとに以下を行う。
- レースidを利用してrace_each_horse_dataからhorse_idを複数取得し、それぞれに対して以下を行う
    * horese_idとレース日時から過去のレース記録データを5回分取得（無いものはゼロ埋め）してtrain dataとする。
    * ラベルはひとまず順位にしておく...？
### 回収率最大化
上位入賞予測のモデルを用いて、馬の候補をいくつかに絞る。強化学習や遺伝的アルゴリズムを用いて回収率を最大化させる。

## 学習
### シンプルな馬ごとの予測
単勝予測、複勝予測などの、馬ごとにある程度の予測ができるように。また、10位入賞しない馬を排除できるように

### 回収率の最大化
先程の予測をもとに、データセットを画一化。レースごとに予測値の上位10頭を用いて、単勝・複勝・3連単などを組み合わせた買い方を学習させ、回収率を最大化させる。強化学習や遺伝的アルゴリズムを利用




## 参考サイト
- [大井競馬で帝王賞を機械学習で当てた話](https://qiita.com/ishizakiiii/items/3b894b6e987fdf87093e)
レース情報のページから、レースに出る馬の過去情報があるページへのリンクを取得し、そのリンク先のページから直近１０レース、その馬がどのようなレース結果だったのかを取得します。

- [ディープラーニングさえあれば、競馬で回収率100%を超えられる](https://qiita.com/yossymura/items/334a8f3ef85bff081913)
